DROP TABLE IF EXISTS BOOKINGS;
DROP TABLE IF EXISTS ITEMS;
DROP TABLE IF EXISTS ITEM_REQUESTS;
DROP TABLE IF EXISTS USERS;

CREATE TABLE IF NOT EXISTS USERS
(
    id    INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name  VARCHAR(16) NOT NULL,
    email VARCHAR(32) NOT NULL,
    CONSTRAINT UQ_USER_EMAIL UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS ITEM_REQUESTS
(
    id           INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description  VARCHAR(64) NOT NULL,
    requestor_id INT         NOT NULL,
    created      TIMESTAMP   NOT NULL,
    FOREIGN KEY (requestor_id) REFERENCES USERS (id) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS ITEMS
(
    id           INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name         VARCHAR(32) NOT NULL,
    description  VARCHAR(64) NOT NULL,
    is_available BOOLEAN     NOT NULL,
    owner_id     INT         NOT NULL,
    request_id   INT         NOT NULL,
    FOREIGN KEY (owner_id) REFERENCES USERS (id) ON DELETE CASCADE,
    FOREIGN KEY (request_id) REFERENCES ITEM_REQUESTS (id) ON DELETE CASCADE
);


CREATE TABLE IF NOT EXISTS BOOKINGS
(
    id         INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    start_time TIMESTAMP                    NOT NULL,
    end_time   TIMESTAMP                    NOT NULL,
    item_id    INT                          NOT NULL,
    booker_id  INT                          NOT NULL,
    status     ENUM ('WAITING', 'APPROVED') NOT NULL,
    FOREIGN KEY (item_id) REFERENCES ITEMS (id) ON DELETE CASCADE,
    FOREIGN KEY (booker_id) REFERENCES USERS (id) ON DELETE CASCADE
);